####################################################################################################
# partition
####################################################################################################

USE clonezilla
DO NOT USE debian installer patition tool

gdisk /dev/sda
partprobe /dev/sda

mkfs.ext4 \
-b 4096 \
-E lazy_itable_init=0,lazy_journal_init=0 \
-O extent,large_file \
/dev/sda1

####################################################################################################
# console font
####################################################################################################

dpkg-reconfigure console-setup
/etc/default/console-setup
CHARMAP="UTF-8"
CODESET="guess"
FONTFACE="TerminusBold"
FONTSIZE="16x32"

####################################################################################################
# debian repository
####################################################################################################

/etc/apt/sources.list

deb     http://cdn.debian.or.jp/debian unstable main contrib non-free
deb-src http://cdn.debian.or.jp/debian unstable main contrib non-free

deb     http://www.deb-multimedia.org unstable main non-free
deb-src http://www.deb-multimedia.org unstable main non-free

aptitude update
aptitude install deb-multimedia-keyring
aptitude update

####################################################################################################
# package install 1
####################################################################################################

git
vim
ufw
openssh-server

####################################################################################################
# firewall
####################################################################################################

ufw allow from 192.168.0.0/24 to 192.168.0.0/24 port 22
ufw enable

####################################################################################################
# git repository
####################################################################################################

git clone git@github.com:murakamiy/MediaCenter.git
git clone git@github.com:murakamiy/epgdump_py.git
git clone git@github.com:murakamiy/dotfile.git

####################################################################################################
# mount option
####################################################################################################

/etc/fstab
/dev/sda1  / ext4  noatime,nodiratime,discard,errors=remount-ro  0  1

####################################################################################################
# package install 2
####################################################################################################

autoconf automake
build-essential
dkms
ffmpeg
gawk
gdisk
hwinfo
iotop
linux-headers-amd64
lm-sensors
lockfile-progs
mdadm
parted
pcscd libpcsclite1 libpcsclite-dev pcsc-tools
pkg-config
python-dateutil
screen
smbclient
sqlite3
trash-cli
unzip
xmlstarlet
zenity
zip
astyle
htop
imagemagick
iotop
mkvtoolnix
mp4v2-utils
mplayer2
python-pysqlite2
vlc
vobcopy
xdg-utils

fonts-takao
fonts-takao-gothic
fonts-takao-mincho

xfce4
xfce4-artwork
xfce4-panel
xfce4-session
xfce4-settings
xfce4-taskmanager
xfce4-terminal
thunar
lightdm

lsof
pulseaudio

handbrake-cli

libusb-dev
libbluetooth-dev
libdbus-1-dev
libdbus-glib-1-dev
python-qt4-dev
python-qt4
pyqt4-dev-tools
libjack-jackd2-dev
python-dbus
bluez

firmware-linux
firmware-linux-nonfree 
firmware-realtek

####################################################################################################
# remove package
####################################################################################################

udisks2

####################################################################################################
# boot loader
####################################################################################################

dpkg-reconfigure grub-pc
grub install devices:

####################################################################################################
# sshd
####################################################################################################

/etc/ssh/sshd_config
PasswordAuthentication no

####################################################################################################
# mdadm
####################################################################################################

/etc/default/mdadm
INITRDSTART='none'
AUTOSTART=true
AUTOCHECK=false
START_DAEMON=false

rm /etc/cron.d/mdadm
rm /etc/cron.daily/mdadm

####################################################################################################
# grub
####################################################################################################

/etc/default/grub
GRUB_TIMEOUT=5
GRUB_CMDLINE_LINUX_DEFAULT=""
GRUB_TERMINAL=console
GRUB_GFXMODE=1024x768
GRUB_DISABLE_LINUX_UUID=true

####################################################################################################
# tmpfs
####################################################################################################

/etc/default/tmpfs
RAMTMP=yes

####################################################################################################
# group
####################################################################################################

groupadd media
vigr
vigr -s
media:x:1001:mc

####################################################################################################
# sudoers
####################################################################################################

%media ALL=(ALL) PASSWD: ALL, NOPASSWD: /home/mc/xdg-user-dirs/media/ubin/wakeuptool,/home/mc/xdg-user-dirs/media/ubin/disk-power-control,/sbin/fsck.ext4,/home/mc/xdg-user-dirs/media/ubin/mounttmp,/home/mc/xdg-user-dirs/media/bin/mount.sh

####################################################################################################
# crontab
####################################################################################################

PATH=/usr/local/sbin:/usr/local/bin:/sbin:/bin:/usr/sbin:/usr/bin
5 13 * * * bash /home/mc/xdg-user-dirs/media/bin/mkjob.sh

####################################################################################################
# user directory
####################################################################################################

~/.config/user-dirs.dirs

mkdir "$HOME/xdg-user-dirs/desktop"
mkdir "$HOME/xdg-user-dirs/download"
mkdir "$HOME/xdg-user-dirs/templates"
mkdir "$HOME/xdg-user-dirs/publicshare"
mkdir "$HOME/xdg-user-dirs/documents"
mkdir "$HOME/xdg-user-dirs/music"
mkdir "$HOME/xdg-user-dirs/pictures"
mkdir "$HOME/xdg-user-dirs/videos"

xdg-user-dirs-update  --set  DESKTOP      "$HOME/xdg-user-dirs/desktop"
xdg-user-dirs-update  --set  DOWNLOAD     "$HOME/xdg-user-dirs/download"
xdg-user-dirs-update  --set  TEMPLATES    "$HOME/xdg-user-dirs/templates"
xdg-user-dirs-update  --set  PUBLICSHARE  "$HOME/xdg-user-dirs/publicshare"
xdg-user-dirs-update  --set  DOCUMENTS    "$HOME/xdg-user-dirs/documents"
xdg-user-dirs-update  --set  MUSIC        "$HOME/xdg-user-dirs/music"
xdg-user-dirs-update  --set  PICTURES     "$HOME/xdg-user-dirs/pictures"
xdg-user-dirs-update  --set  VIDEOS       "$HOME/xdg-user-dirs/videos"

####################################################################################################
# sensor
####################################################################################################
/etc/modules

it87
####################################################################################################
# autologin
####################################################################################################

/etc/lightdm/lightdm.conf
autologin-user=mc
autologin-user-timeout=0

####################################################################################################
# mime type png
####################################################################################################

application -> setting -> mime type editor -> png -> PNGHandler

####################################################################################################
# wake on lan
####################################################################################################

BIOS
Advanced -> APM -> Power On by PCIE : Enabled

ethtool -s eth0 wol d
ethtool -s eth0 wol g
ethtool eth0

####################################################################################################
# wakeuptool
####################################################################################################

wakeup_time=$(awk 'BEGIN { print systime() + 120 }')
date
sleep 20
sudo /home/mc/xdg-user-dirs/media/ubin/wakeuptool -w -t $wakeup_time

####################################################################################################
# pt3
####################################################################################################

dkms add /usr/src/pt3_drv-0.0.1
dkms build pt3_drv/0.0.1
dkms install pt3_drv/0.0.1
dkms status

####################################################################################################
# USBデバイス情報取得
####################################################################################################

udevadm info --query=path --name=/dev/input/js0 --attribute-walk

####################################################################################################
# xfce config
####################################################################################################

xfce config
export DISPLAY=":0.0"
xfconf-query -l
xfconf-query -lv -c xfce4-desktop
xfconf-query -c xfce4-desktop -p /backdrop/screen0/monitor0/image-path -s /home/mc/xdg-user-dirs/media/job/state/background/job.bmp

####################################################################################################
# raid
####################################################################################################

# Hard Disk Array
umount /dev/md0
mdadm --stop /dev/md0

mdadm --zero-superblock /dev/disk/by-id/ata-WDC_WD25EZRX-00MMMB0_WD-WCAWZ1376530
mdadm --zero-superblock /dev/disk/by-id/ata-WDC_WD25EZRX-00MMMB0_WD-WCAWZ1234078

mdadm --create /dev/md0 --level=0 --raid-devices=2 -c 1024 \
/dev/disk/by-id/ata-WDC_WD25EZRX-00MMMB0_WD-WCAWZ1376530 \
/dev/disk/by-id/ata-WDC_WD25EZRX-00MMMB0_WD-WCAWZ1234078

gdisk /dev/md0
partprobe /dev/md0

mkfs.ext4 \
-m 0 \
-b 4096 \
-E stride=256,stripe-width=512,lazy_itable_init=0,lazy_journal_init=0 \
-O extent,large_file,sparse_super \
/dev/md0

mount -o noatime,stripe=512 /dev/md0 /mnt/hd_array
mkdir /mnt/hd_array/ts_hd
chown mc:mc /mnt/hd_array/ts_hd

mdadm --detail --scan >> /etc/mdadm/mdadm.conf
update-initramfs -u

